# Взаимодействие сервисов
Кривопиша Сергей

Курс Software Architect

## Немного контекста
Это домашнее задание выполнено на основе ката, которая была использована и решена в предыдущем домашнем задании - ката Нила Форда, а именно Room with a View: https://nealford.com/katas/kata?id=RoomWithAView

[Домашнее задание #1 (Анализ требований и подготовка архитектурному решению)](homework_01.md)\
[Домашнее задание #2 (Декомпозиция на функциональные компоненты)](homework_02.md)

**Контекст**

Компания — крупный поставщик услуг по бронированию, стремящийся выйти на рынок премиум-класса, предлагая услуги для элитных курортов и спа-центров. Новый продукт, система бронирования и управления номерами, будет ориентирован на улучшение пользовательского опыта, предоставляя гостям удобный способ выбора номеров и усовершенствованные возможности для управления ресурсами отеля.

Система бронирования и управления номерами отеля включает в себя несколько ключевых сервисов, которые взаимодействуют друг с другом для обеспечения функциональности и улучшения пользовательского опыта. Важно, чтобы архитектура была гибкой, масштабируемой и легко модифицируемой, что позволяет адаптировать систему под будущие изменения и улучшения.

В данном случае мы рассмотрим взаимодействие между основными сервисами на основе выбранной декомпозиции по пользовательским потокам (Use Case).

### Основные сервисы и их взаимодействие

#### 1. **Сервис бронирования**
- **Основные функции**: поиск доступных номеров, выбор номеров, выбор дат, обработка платежей.
- **Взаимодействие с другими сервисами**:
  - **Сервис управления доступом**: Когда гость завершает процесс бронирования, сервис бронирования передает информацию о номере и сроках бронирования в сервис управления доступом для генерации виртуального ключа.
  - **Сервис уведомлений**: После успешного бронирования, сервис уведомлений отправляет гостю подтверждение бронирования.
  - **Сервис аналитики**: Информация о бронированиях поступает в сервис аналитики для формирования отчетов о загрузке номеров и трендах.
  
#### 2. **Сервис управления статусами номеров**
- **Основные функции**: обновление статусов номеров (доступен, занят, на уборке), планирование уборки, генерирование приоритетов для персонала.
- **Взаимодействие с другими сервисами**:
  - **Сервис бронирования**: Когда гость бронирует номер, статус этого номера меняется на «занят». После окончания срока бронирования статус меняется на «доступен».
  - **Сервис уведомлений**: Когда номер готов или требует уборки, сервис уведомлений сообщает персоналу о задачах.
  - **Сервис аналитики**: Данные о загрузке номеров и времени, затраченном на уборку, используются для анализа и оптимизации работы персонала.
  
#### 3. **Сервис управления доступом**
- **Основные функции**: генерация виртуальных ключей для гостей, интеграция с системой замков, обновление ключей при изменении бронирования.
- **Взаимодействие с другими сервисами**:
  - **Сервис бронирования**: При успешном бронировании сервис генерирует виртуальный ключ и отправляет его в интерфейс гостя.
  - **Сервис управления статусами номеров**: Когда номер становится доступным для нового гостя, система обновляет статус и сообщает сервису доступа для генерации нового ключа.
  - **Сервис уведомлений**: Уведомляет гостей о готовности их ключа, если нужно.
  
#### 4. **Сервис уведомлений**
- **Основные функции**: уведомления для гостей (статус бронирования, напоминания, рекомендации), уведомления для персонала (задачи, обновления статусов).
- **Взаимодействие с другими сервисами**:
  - **Сервис бронирования**: после завершения бронирования уведомление отправляется гостю с подтверждением и информацией.
  - **Сервис управления статусами номеров**: персонал уведомляется о задачах, например, уборке номеров или подготовки для нового гостя.
  - **Сервис аналитики**: в случае необходимости отправки уведомлений по определенным событиям, например, при наличии проблем с обслуживанием, система отправляет информацию для дальнейшего анализа и обработки.
  
#### 5. **Сервис аналитики**
- **Основные функции**: сбор и анализ данных о загрузке номеров, производительности персонала, отчетность.
- **Взаимодействие с другими сервисами**:
  - **Сервис бронирования**: данные о новых бронированиях используются для анализа загрузки номеров.
  - **Сервис управления статусами номеров**: статистика по состоянию номеров (например, время на уборку) поступает в сервис аналитики.
  - **Сервис уведомлений**: уведомления о проблемах или достижениях персонала (например, повышение эффективности уборки) также анализируются и могут использоваться для корректировки процессов.

### Оценка архитектурного решения

1. **Гибкость и модифицируемость**:
   - Декомпозиция на микросервисы позволяет легко вносить изменения и добавлять новые функции, такие как новые способы оплаты или расширенные возможности для персонализированных уведомлений.
   - Каждый сервис работает независимо, что уменьшает влияние изменений в одном сервисе на другие части системы. Это способствует гибкости при добавлении новых функций или изменении существующих.

2. **Масштабируемость**:
   - Все ключевые сервисы могут быть масштабированы независимо в зависимости от нагрузки. Например, сервис уведомлений может потребовать дополнительной мощности в праздничные дни или в случае пиковых нагрузок.
   - Взаимодействие между сервисами основано на стандартных API, что позволяет быстро адаптировать систему к изменяющимся требованиям бизнеса.

3. **Производительность**:
   - Архитектура с микросервисами гарантирует, что каждый сервис может быть оптимизирован для своих задач. Например, сервис бронирования будет работать с высокой производительностью, обрабатывая запросы пользователей, а сервис аналитики может быть оптимизирован для выполнения сложных вычислений в фоне.
   - При правильном распределении нагрузки между сервисами можно достичь высокой производительности системы в целом.

4. **Надежность**:
   - Микросервисная архитектура способствует высокой отказоустойчивости, так как сбой одного сервиса не приведет к полной остановке всей системы.
   - Например, если сервис уведомлений не работает, это не повлияет на основную работу системы бронирования, управления номерами и доступа.

5. **Поддержка и сопровождение**:
   - Архитектура требует хорошо организованной системы мониторинга и логирования, чтобы отслеживать состояние каждого из сервисов. Проблемы в одном сервисе могут вызвать цепную реакцию, и их нужно быстро обнаружить.
   - Каждый сервис должен быть снабжен мониторингом и системой оповещений, чтобы оперативно устранять проблемы.

### Заключение
Этот подход, несмотря на некоторую сложность в поддержке микросервисной инфраструктуры, обеспечивает высокую надежность и адаптивность системы, которая легко масштабируется и модифицируется. 

## Критичный сценарий (Use-Case): Бронирование номера
Бронирование номера является критически важной функцией для системы бронирования отеля, так как она непосредственно влияет на клиентский опыт. Ошибки в этом процессе могут привести к неудовлетворенности гостей и, как следствие, к потерям для бизнеса.

### Диаграмма последовательности (Sequence Diagram)
Диаграмма последовательности для сценария **Бронирование номера** отображает взаимодействие между объектами системы, которые участвуют в процессе бронирования. Сценарий предполагает, что гость ищет доступные номера, выбирает номер и даты, вводит данные для оплаты, и система завершает бронирование.

// здесь должна быть диаграмма 

### Оценка атрибутов качества для критического сценария "Бронирование номера"
1. **Надежность**
    - **Сценарий:** За счет использования микросервисов и их изолированности, при сбое одного сервиса (например, сервис оплаты) система продолжит работать, но с ограниченным функционалом.
    - **Показатели:** Уровень доступности системы — 99.9% (с учетом распределенной архитектуры). Возможность восстановления после отказа — меньше 5 минут.
2. **Производительность**
    - **Сценарий:** Процесс бронирования должен быть быстрым и эффективным, поскольку высокие задержки могут снизить удобство использования системы.
    - **Показатели:** Время отклика при поиске номеров — менее 2 секунд. Время завершения бронирования — не более 5 секунд (включая оплату и уведомление).
3. **Модифицируемость**
    - **Сценарий:** Добавление новых способов оплаты или обновление логики бронирования (например, поддержка криптовалюты).
    - **Показатели:** Система должна быть легко модифицируемой благодаря четкой разделенности микросервисов. Изменения в модуле оплаты не должны затрагивать другие части системы.
4. **Масштабируемость**
    - **Сценарий:** Система должна быть способна обрабатывать большое количество запросов бронирования в пиковые сезоны без снижения производительности.
    - **Показатели:** Система должна поддерживать горизонтальное масштабирование каждого сервиса. Система должна быть способна обрабатывать до 1000 запросов в минуту в период пиковых нагрузок.
5. **Безопасность**
    - **Сценарий:** Обработка данных о клиентах и транзакциях требует высокой степени безопасности.
    - **Показатели:** Все платежи должны быть зашифрованы с использованием стандартов безопасности (например, TLS/SSL). Личные данные пользователей должны храниться в зашифрованном виде.
6. **Устойчивость к отказам**
    - **Сценарий:** Система должна обеспечивать бесперебойную работу в случае отказа одного из сервисов (например, сбой сервиса уведомлений).
    - **Показатели:** Система должна обеспечивать продолжение работы даже при отказе отдельных сервисов, благодаря наличию резервных копий и механизмам восстановления.
7. **Поддержка**
    - **Сценарий:** Обеспечение поддержки и мониторинга всех сервисов.
    - **Показатели:** Время реакции на инциденты — менее 10 минут. Наличие системы мониторинга и оповещений, которая отслеживает статус всех критичных сервисов в реальном времени.
8. **Легкость интеграции**
    - **Сценарий:** Интеграция с внешними сервисами, такими как системы оплаты, системы замков или внешние CRM.
    - **Показатели:** Интеграция через стандартизированные API с возможностью расширения и настройки под требования сторонних систем.
  
### Заключение
Сценарий "Бронирование номера" является основой для функционирования системы, и важно обеспечить его бесперебойную работу и высокий уровень надежности. Архитектура на основе микросервисов, с четким разделением функциональности и возможности горизонтального масштабирования, позволяет эффективно справляться с изменениями нагрузки и поддерживает высокую модифицируемость и интеграцию с внешними сервисами.
